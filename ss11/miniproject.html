<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      let students = [
        { id: 1, name: "Nguyen Van A", age: 17, gpa: 8.6, status: "active" },
        { id: 2, name: "Nguyen Van B", age: 18, gpa: 7.6, status: "active" },
        { id: 3, name: "Nguyen Van C", age: 20, gpa: 9.6, status: "inactive" },
        { id: 4, name: "Nguyen Van D", age: 21, gpa: 6.6, status: "active" },
      ];

      let nextId = 5;

      const show = (list, title = "DANH SACH SINH VIEN") => {
        if (!list.length) return alert("Khong co du lieu!");
        let text = `==== ${title} ====\n`;
        list.forEach(
          (s) =>
            (text += `ID:${s.id} | ${s.name} | Tuoi:${s.age} | GPA:${s.gpa} | Trang thai:${s.status}\n`),
        );
        alert(text);
      };

      function menu() {
        return prompt(
          `===== HE THONG QUAN LY SINH VIEN =====
        1. Them sinh vien
        2. Xem tat ca sinh vien
        3. Danh sach hoc bong (GPA > 8)
        4. Cap nhat sinh vien
        5. Xoa sinh vien
        6. Kiem tra dieu kien
        7. Thong ke hoc tap
        8. Chuan hoa ten (IN HOA)
        0. Thoat`,
        );
      }

      function main() {
        while (true) {
          let choice = menu();

          switch (choice) {
            case "1": {
              let name = prompt("Nhap ten sinh vien:");
              let age = +prompt("Nhap tuoi:");
              let gpa = +prompt("Nhap GPA (0-10):");
              let status = prompt(
                "Nhap trang thai (active/inactive):",
              )?.toLowerCase();

              if (
                !name ||
                age <= 0 ||
                gpa < 0 ||
                gpa > 10 ||
                !["active", "inactive"].includes(status)
              )
                return alert("Du lieu khong hop le!");

              students.push({ id: nextId++, name, age, gpa, status });
              alert("Them sinh vien thanh cong!");
              break;
            }

            case "2":
              show(students, "TAT CA SINH VIEN");
              break;

            case "3":
              show(
                students.filter((s) => s.gpa > 8),
                "DANH SACH HOC BONG",
              );
              break;

            case "4": {
              let id = +prompt("Nhap ID sinh vien can cap nhat:");
              let s = students.find((x) => x.id === id);
              if (!s) return alert("Khong tim thay sinh vien!");

              let newName = prompt("Nhap ten moi:", s.name);
              let newGpa = prompt("Nhap GPA moi:", s.gpa);

              if (newName) s.name = newName;
              if (newGpa >= 0 && newGpa <= 10) s.gpa = +newGpa;

              alert("Cap nhat thanh cong!");
              break;
            }

            case "5": {
              let id = +prompt("Nhap ID sinh vien can xoa:");
              let index = students.findIndex((s) => s.id === id);
              if (index === -1) return alert("Khong tim thay sinh vien!");

              if (confirm("Ban co chac chan muon xoa?"))
                students.splice(index, 1);

              alert("Da xoa sinh vien!");
              break;
            }

            case "6": {
              let hasMinor = students.some((s) => s.age < 18);
              let allActive = students.every((s) => s.status === "active");

              alert(
                `==== KIEM TRA DIEU KIEN ====
                Co sinh vien duoi 18 tuoi: ${hasMinor}
                Tat ca sinh vien dang hoat dong: ${allActive}`,
              );
              break;
            }

            case "7": {
              if (!students.length) return alert("Khong co du lieu!");

              let total = students.reduce((sum, s) => sum + s.gpa, 0);
              let avg = (total / students.length).toFixed(2);
              let max = students.reduce((a, b) => (a.gpa > b.gpa ? a : b));
              let min = students.reduce((a, b) => (a.gpa < b.gpa ? a : b));

              alert(
                `==== THONG KE ====
                Tong so sinh vien: ${students.length}
                Diem trung binh: ${avg}
                Cao nhat: ${max.name} (${max.gpa})
                Thap nhat: ${min.name} (${min.gpa})`,
              );
              break;
            }

            case "8":
              show(
                students.map((s) => ({ ...s, name: s.name.toUpperCase() })),
                "DANH SACH TEN IN HOA",
              );
              break;

            case "0":
              return alert("Thoat chuong trinh. Tam biet!");

            default:
              alert("Lua chon khong hop le!");
          }
        }
      }
      main();
    </script>
  </body>
</html>
